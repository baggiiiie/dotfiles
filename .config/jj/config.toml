"$schema" = "https://jj-vcs.github.io/jj/latest/config-schema.json"

[user]
name = "baggiiiie"
email = "yc@yingchaoooo.com"

[[--scope]]
--when.repositories = ["~/Desktop/repos/work/"]

[--scope.user]
name = "ydai"
email = "yingchao.dai@illumina.com"

[--scope.signing]
backend = "none"

[signing]
behavior = "own"
backend = "ssh"
key = "~/.ssh/baggiiiie-github.pub"


# [Settings - Jujutsu docs](https://jj-vcs.github.io/jj/latest/config/#config-files-and-toml)
[ui]
default-command = "log"
# diff-formatter = ":git"
# https://github.com/idursun/jjui/issues/314#issuecomment-3367379291
diff-formatter = [
    "bash",
    "-c",
    "delta --width $width $left $right --features=split-view || true",
]
# diff-formatter = ["difft", "--color=always", "$left", "$right"]

graph.style = "square"
pager = "delta"

editor = "nvim"
diff-editor = ["nvim", "-c", "DiffEditor $left $right $output"]
# diff-editor = "meld"
# diff-editor = "diffedit3"
# Use merge-tools.meld.merge-args
# merge-editor = "meld" # Or "vscode" or "vscodium" or "kdiff3" or "vimdiff"

[merge-tools.delta-non-split-view]
program = "delta"
diff-args = [
    "--width",
    "$width",
    "--features",
    "non-split-view",
    "$left",
    "$right",
]

[git]
# Prevent pushing work in progress or anything explicitly labeled "private"
private-commits = "description(glob:'wip:*') | description(glob:'private:*')"
# recommended by https://zerowidth.com/2025/jj-tips-and-tricks
push-new-bookmarks = true
abandon-unreachable-commits = true

[snapshot]
auto-update-stale = true

[revset-aliases]
# set all remote bookmarks (commits pushed to remote branches) to be immutable
'immutable_heads()' = "builtin_immutable_heads() | remote_bookmarks()"
# 'immutable_heads()' = "builtin_immutable_heads()"
# NOTE: go down 5 commits from current commit (down the stack)
'stack()' = 'ancestors(reachable(@, mutable()), 5)'
'stack(n)' = 'ancestors(reachable(@, mutable()), n)'
'stack(x, n)' = 'ancestors(reachable(x, mutable()), n)'

'closest_bookmark(to)' = 'heads(::to & bookmarks())'

"private()" = 'mutable() & description(regex:"(?i)^(private|wip)(\n*$|:)")'

[templates]
git_push_bookmark = '"yc/test-" ++ change_id.shortest()'

# NOTE: this is from: https://github.com/jj-vcs/jj/discussions/5812#discussioncomment-12320164
# it shows revisions that will be pushed to remote
log_node = '''
if(self && !current_working_copy && !immutable && !conflict && in_branch(self) && !private_commits(self),
  "â†‘",
  builtin_log_node
)
'''

[template-aliases]
# Full timestamp in ISO 8601 format
# 'format_timestamp(timestamp)' = 'timestamp'
# Relative timestamp rendered as "x days/hours/seconds ago"
'format_timestamp(timestamp)' = 'timestamp.ago()'
# 'format_short_id(id)' = 'id.shortest()'
"in_branch(commit)" = 'commit.contained_in("immutable_heads()..bookmarks()")'
"private_commits(commit)" = 'commit.contained_in("private()")'

[aliases]
ab = ["abandon"]
abs = ["absorb"]
c = ["commit"]
ci = ["commit", "--interactive"]
d = ["diff"]
dup = ["duplicate"]
e = ["edit"]
g = ["git"]
n = ["new"]
rb = ["rebase"]
res = ["resolve"]
res-auto = ["resolve", "--tool", "mergiraf"]
sp = ["split"]
spi = ["split", "--interactive"]
sq = ["squash"]
sqi = ["squash", "--interactive"]
tug = ["bookmark", "move", "--from", "closest_bookmark(@-)", "--to", "@"]
spr = ["util", "exec", "--", "jj-spr"]
